# 11장 뉴스 피드 시스템 설계 

뉴스 피드는 여러분의 홈 페이지 중앙에 지속적으로 업데이트되는 스토리들로, 사용자 상태 정보 업데이트, 사진, 비디오, 링크, 앱 활동 등등을 포함한다.

## 1단계 문제 이해 및 설계 범위 확정

- 뉴스 피드에 새로운 스토리를 올릴 수 있어야 한다 
- 친구들이 올리는 스토리를 볼 수 있어야 한다
- 뉴스 피드는 시간 흐름 역순으로 표시
- 한 명의 사용자는 최대 5000명의 친구를 가질 수 있다
- 트래픽 규모는 매일 천만 명

## 2단계 개략적 설계안 제시 및 동의 구하기

- 피드 발행: 사용자가 스토리를 포스팅하면 해당 데이터를 데이터베이스와 캐시에 기록, 새 포스팅은 친구의 뉴스피드에 전송
- 뉴스 피드 생성: 모든 친구의 포스팅을 시간 흐름 역순으로 모아서 만든다

### 뉴스 피드 API

- 피드 발행 API `POST /v1/me/feed`
  - 새 스토리를 포스팅하기 위한 API
  - body: 포스팅 내용
  - Authorization 헤더: API 호출을 인증하기 위해 사용된다
- 피드 읽기 API `GET /v1/me/feed`
  - 뉴스 피드 가져오는 API
  - Authorization 헤더: API 호출을 인증하기 위해 사용된다

### 피드 발행

- 사용자가 피드 발행을 했다
- 피드 발행 API `POST /v1/me/feed` 호출
- 로드밸런서를 통해 트래픽을 웹 서버로 분산
- 웹서버는 HTTP 요청을 내부 서비스로 중계 -> 포스팅 저장 서비스, 포스팅 전송 서비스, 알림 서비스
- 포스팅 저장 서비스: 새 포스팅을 데이터베이스와 캐시에 저장
- 포스팅 전송 서비스: 새 포스팅을 친구의 뉴스 피드로 푸시한다, 뉴스 피드 데이터는 캐시 보관
- 알림 서비스: 친구들에게 새 포스팅이 올라왔음을 알림

### 뉴스 피드 생성

- 사용자가 보는 뉴스피드
- 피드 읽기 API `GET /v1/me/feed` 호출
- 로드밸런서를 통해 트래픽을 웹 서버로 분산
- 웹서버는 트래픽을 뉴스 피드 서비스로 보낸다
- 뉴스 피드 서비스: 캐시에서 뉴스 피드를 가져오는 서비스
- 뉴스 피드 캐시: 뉴스 피드를 랜더링할 때 필요한 피드 ID를 보관

## 3단계 상세 설계



